#!/bin/bash
# vcn - vChain CodeNotary
#
# Copyright (c) 2018-2021 vChain, Inc. All Rights Reserved.
# This software is released under GPL3.
# The full license information can be found under:
# https://www.gnu.org/licenses/gpl-3.0.en.html
version_string=$(curl -s https://api.github.com/repos/codenotary/vcn/releases/latest | awk '/tag_name/ {gsub(/"/,""); gsub(/,/,""); print $2}')
base_url=https://github.com/codenotary/vcn/releases/latest/download
echo "Latest available release for VCN is: $version_string"
linux_file="$base_url/vcn-$version_string-linux-amd64-static"
windows_file="$base_url/vcn-$version_string-windows-amd64.exe"
mac_file="$base_url/vcn-$version_string-darwin-amd64"
os_name=$(uname -s)
out=""

case "${os_name}" in
    Linux*)     target=$linux_file;;
    Darwin*)    target=$mac_file;;
    CYGWIN*)    target="$windows_file" && out=".exe";;
    MINGW*)     target="$windows_file" && out=".exe";;
    *)          echo "Unsupported runner OS, aborting VCN Download" && exit 1;;
esac

curl -s -L "$target" -o vcn"$out" && chmod +x vcn*
echo "Succesfully acquired VCN binary"
